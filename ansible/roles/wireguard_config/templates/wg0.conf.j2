[Interface]
Address = {{ wireguard_server.address }}
PrivateKey = {{ wireguard_server.private_key }}
ListenPort = {{ wireguard_server.listen_port | default(51820) }}
PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE

{% for peer in wireguard_peers %}[Peer]
{% if peer.name is defined %}# {{ peer.name }}
{% endif %}PublicKey = {{ peer.public_key }}
{% if peer.preshared_key is defined and peer.preshared_key %}PresharedKey = {{ peer.preshared_key }}
{% endif %}AllowedIPs = {{ peer.allowed_ips }}

{% endfor %}